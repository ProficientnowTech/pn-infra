# Production Environment
# Platform Storage applications with sync wave ordering
applications:
- name: ceph-operator
  annotations:
    argocd.argoproj.io/sync-wave: '-200'
  destinationNamespaceOverwrite: 'ceph-operator'
  syncOptions:
  - ServerSideApply=true
  - Replace=true

- name: ceph-cluster-pn-hyd-a
  annotations:
    argocd.argoproj.io/sync-wave: '-100'
  sources:
  - repoURL: https://github.com/ProficientnowTech/pn-infra.git
    targetRevision: v2
    path: platform/stacks/storage/charts/ceph-cluster
  destinationNamespaceOverwrite: 'ceph-cluster'
  syncOptions:
  - ServerSideApply=true
  - CreateNamespace=true
  - RespectIgnoreDifferences=true
  ignoreDifferences:
  - group: ceph.rook.io
    kind: CephCluster
    jqPathExpressions:
    - .status
    - .spec.cephVersion.image
    - .spec.placement
  - group: ceph.rook.io
    kind: CephBlockPool
    jqPathExpressions:
    - .status
  - group: ceph.rook.io
    kind: CephFilesystem
    jqPathExpressions:
    - .status
  - group: ceph.rook.io
    kind: CephObjectStore
    jqPathExpressions:
    - .status
  - group: storage.k8s.io
    kind: StorageClass
    jqPathExpressions:
    - .parameters

- name: zalando-postgres-operator
  annotations:
    argocd.argoproj.io/sync-wave: '0'
  destinationNamespaceOverwrite: zalando-postgres-operator
  syncOptions:
  - ServerSideApply=true
  - Replace=true

# - name: stackgres-postgres-operator
#   annotations:
#     argocd.argoproj.io/sync-wave: '0'
#   destinationNamespaceOverwrite: stackgres-postgres-operator
#   syncOptions:
#   - ServerSideApply=true
#   - Replace=true

# - name: cloudnative-pg-operator
#   annotations:
#     argocd.argoproj.io/sync-wave: '0'
#   destinationNamespaceOverwrite: cloudnative-pg-operator
#   syncOptions:
#   - ServerSideApply=true
#   - Replace=true

- name: scylladb-operator
  annotations:
    argocd.argoproj.io/sync-wave: '0'
  destinationNamespaceOverwrite: scylla-operator
  syncOptions:
  - ServerSideApply=true
  - Replace=true

- name: percona-everest
  annotations:
    argocd.argoproj.io/sync-wave: '0'
  destinationNamespaceOverwrite: everest-system
  syncOptions:
  - CreateNamespace=true
  - ServerSideApply=true
  - Replace=true
  - SkipDryRunOnMissingResource=true
  - RespectIgnoreDifferences=true
  ignoreDifferences:
  # Everest operator updates LoadBalancerConfig status
  - group: everest.percona.com
    kind: LoadBalancerConfig
    jqPathExpressions:
    - .status
    - .metadata.finalizers

- name: redis-operator
  annotations:
    argocd.argoproj.io/sync-wave: '0'
  destinationNamespaceOverwrite: redis-operator
  syncOptions:
  - CreateNamespace=true
  - ServerSideApply=true
  - Replace=true

- name: clickhouse-operator
  annotations:
    argocd.argoproj.io/sync-wave: '0'
  destinationNamespaceOverwrite: clickhouse-operator
  syncOptions:
  - CreateNamespace=true
  - ServerSideApply=true
  - RespectIgnoreDifferences=true
  ignoreDifferences:
  # Kubernetes auto-populates apiVersion in fieldRef env vars, causing OutOfSync
  - group: apps
    kind: Deployment
    jsonPointers:
    - /spec/template/spec/containers/0/env
    - /spec/template/spec/containers/1/env

commonLabels:
  platform.pnats.cloud/environment: 'production'
