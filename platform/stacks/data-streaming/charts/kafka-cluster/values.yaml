# Namespace where the Kafka cluster CR is created.
# IMPORTANT: Strimzi in this repo is currently configured to watch only its own
# namespace (via `STRIMZI_NAMESPACE=metadata.namespace`), so this MUST match the
# operator namespace unless you reconfigure the operator.
namespace: strimzi-kafka-operator

name: pn-kafka

kafka:
  # Kafka broker version; Strimzi defaults to "latest supported" when omitted.
  version: ""

  listeners:
    - name: plain
      port: 9092
      type: internal
      tls: false

  config:
    # Safe defaults for a 3-broker cluster (can tolerate 1 broker down).
    offsets.topic.replication.factor: 3
    transaction.state.log.replication.factor: 3
    transaction.state.log.min.isr: 2
    default.replication.factor: 3
    min.insync.replicas: 2

    # Developer-friendly defaults.
    num.partitions: 6
    auto.create.topics.enable: true
    log.retention.hours: 168

    # KRaft controller quorum tuning.
    # Defaults can be too aggressive on busy/slow environments and can prevent
    # controllers from electing a leader, which in turn makes brokers crash-loop.
    controller.quorum.request.timeout.ms: 10000
    controller.quorum.election.timeout.ms: 10000

externalAccess:
  # Expose Kafka to developers outside the cluster.
  #
  # NOTE: Kafka clients connect to a *bootstrap* address, but then they receive
  # broker addresses from metadata. So while developers configure only one
  # bootstrap endpoint, the brokers still must be reachable too.
  loadBalancer:
    enabled: true
    port: 9094
    tls: true
    metallb:
      addressPool: public-pool
    # Optional: use a custom certificate (e.g., issued by cert-manager) so the
    # broker certificates include your public DNS names and clients can keep
    # hostname verification enabled.
    #
    # If disabled, Strimzi will generate certificates signed by its cluster CA
    # and clients must trust that CA.
    brokerCertChainAndKey:
      enabled: false
      secretName: ""
      certificateKey: tls.crt
      keyKey: tls.key
    dns:
      # These are used only for ExternalDNS annotations. If external-dns is not
      # managing your zone, you can leave them empty and use the allocated IPs.
      bootstrapHostname: kafka.pnats.cloud
      brokerHostnamePrefix: kafka-broker
      brokerHostnameSuffix: pnats.cloud
    allowedSourceRanges: []

  # Strimzi supports an `ingress` listener type (TLS passthrough), but it
  # requires an ingress controller configured for TCP/TLS passthrough and DNS
  # hostnames for bootstrap + each broker. Keep it disabled unless you know your
  # ingress controller supports it.
  ingress:
    enabled: false
    port: 443
    className: nginx
    bootstrapHostname: kafka-ingress.pnats.cloud
    brokerHostnamePrefix: kafka-broker
    brokerHostnameSuffix: pnats.cloud

# Strimzi 0.46+ removed ZooKeeper-based Kafka clusters and requires KRaft mode
# with KafkaNodePool resources for brokers/controllers.
nodePools:
  controllers:
    replicas: 3
    resources:
      requests:
        cpu: 200m
        memory: 1Gi
      limits:
        cpu: 1000m
        memory: 2Gi
    storage:
      size: 10Gi
      storageClass: app-blk-hdd-repl
      deleteClaim: false

  brokers:
    replicas: 3
    resources:
      requests:
        cpu: 500m
        memory: 2Gi
      limits:
        cpu: 2000m
        memory: 4Gi
    storage:
      size: 50Gi
      storageClass: app-blk-hdd-repl
      deleteClaim: false

entityOperator:
  enabled: true
  topicOperator:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
  userOperator:
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi
