namespace: kroxylicious

proxy:
  name: pn-kafka-proxy
  replicas: 2
  resources:
    requests:
      cpu: 250m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi

virtualCluster:
  name: pn-kafka

backend:
  # Strimzi bootstrap service for the internal listener (plain).
  # NOTE: This cluster uses custom DNS domain 'prod-ap-south-2a.local' instead of 'cluster.local'
  bootstrapServers: pn-kafka-kafka-bootstrap.strimzi-kafka-operator.svc.prod-ap-south-2a.local:9092
  nodeIdRanges:
    - name: brokers
      start: 0
      end: 9

ingress:
  name: external-lb
  loadBalancer:
    # NOTE: `KafkaProxyIngress.loadBalancer` requires TLS and does not allow a
    # port suffix in these hostnames.
    bootstrapAddress: kafka.pnats.cloud
    advertisedBrokerAddressPattern: broker-$(nodeId).kafka.pnats.cloud

tls:
  # Secret must contain a certificate that covers:
  # - kafka.pnats.cloud
  # - broker-*.kafka.pnats.cloud (wildcard)
  # NOTE: cert-manager previously issued `kafka-proxy-tls` with a PKCS#1 RSA key
  # ("BEGIN RSA PRIVATE KEY") which Kroxylicious/Netty rejects. Changing the
  # secret name forces cert-manager to issue a fresh cert+key using our PKCS#8
  # settings in the Certificate spec.
  secretName: kafka-proxy-tls-pkcs8

  # Optional: manage the server certificate with cert-manager.
  certificate:
    # Enabled by default because the Kroxylicious operator will not deploy the
    # proxy until the VirtualKafkaCluster TLS secret exists.
    enabled: true
    issuerRef:
      name: letsencrypt-production
      kind: ClusterIssuer
      group: cert-manager.io

metallb:
  enabled: true
  addressPool: public-pool

externalDNS:
  enabled: true
  ttl: 60
  hostnames:
    - kafka.pnats.cloud
    - "*.kafka.pnats.cloud"

audit:
  enabled: true
  saslInspection:
    filterName: sasl-inspection
    # If enabledMechanisms is empty, Kroxylicious defaults to enabling
    # SCRAM-SHA-256, SCRAM-SHA-512, and OAUTHBEARER.
    enabledMechanisms: []
    requireAuthentication: false

# Schema Validation Filter Configuration
# NOTE: RecordValidation filter is in preview status in Kroxylicious 0.18.0
# Currently only supports JSON Schema validation (not Avro/Protobuf)
schemaValidation:
  enabled: false
  filterName: record-validation

  # Apicurio Registry connection
  apicurio:
    # URL for schema resolution (Apicurio Registry v2 API)
    registryUrl: http://apicurio-registry.apicurio-registry.svc:8080/apis/registry/v2

  # Rules for topic-based validation
  # NOTE: Uses explicit topic list, NOT wildcard/regex patterns
  # Each rule targets specific topics by exact name
  rules: []
    # Example rule structure:
    # - topicNames:
    #     - orders.events
    #     - payments.events
    #   valueRule:
    #     schemaValidationConfig:
    #       apicurioGlobalId: 1001  # Schema ID in registry
    #       apicurioRegistryUrl: "http://apicurio-registry.apicurio-registry.svc:8080/apis/registry/v2"
    #     allowNulls: false
    #     allowEmpty: false
    #   keyRule: null  # Optional key validation

  # Default rule for topics not explicitly listed
  # Applied when a topic doesn't match any explicit rule
  defaultRule:
    valueRule:
      # Default: syntactically correct JSON validation
      syntacticallyCorrectJson:
        validateObjectKeysUnique: true
      allowNulls: true
      allowEmpty: true
    keyRule: null
