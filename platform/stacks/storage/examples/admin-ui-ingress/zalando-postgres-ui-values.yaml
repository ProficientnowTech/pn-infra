---
# Zalando PostgreSQL Operator UI - Additional Helm Chart
# The operator itself doesn't include the UI - it's a separate chart

# Deploy the UI with:
# helm repo add postgres-operator-ui-charts https://opensource.zalando.com/postgres-operator/charts/postgres-operator-ui
# helm install postgres-operator-ui postgres-operator-ui-charts/postgres-operator-ui \
#   -f zalando-postgres-ui-values.yaml \
#   -n zalando-postgres-operator

replicaCount: 1

image:
  registry: ghcr.io
  repository: zalando/postgres-operator-ui
  tag: v1.15.1
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

# Environment configuration
envs:
  # Application URL (external URL for the UI)
  appUrl: "https://postgres-ui.pnats.cloud"

  # Operator API endpoint (internal service name)
  operatorApiUrl: "http://postgres-operator:8080"

  # Operator configuration
  operatorClusterNameLabel: "cluster-name"
  operatorUiConfig: |-
    {
      "docs_link":"https://postgres-operator.readthedocs.io/en/latest/",
      "dns_format_string": "{0}.{1}.svc.cluster.local",
      "databases_visible": true,
      "master_load_balancer_visible": true,
      "nat_gateways_visible": false,
      "replica_load_balancer_visible": true,
      "resources_visible": true,
      "users_visible": true,
      "cost_ebs": 0.0952,
      "cost_iops": 0.006,
      "cost_throughput": 0.0476,
      "cost_core": 0.0575,
      "cost_memory": 0.014375,
      "free_iops": 3000,
      "free_throughput": 125,
      "limit_iops": 16000,
      "limit_throughput": 1000,
      "postgresql_versions": [
        "17",
        "16",
        "15",
        "14",
        "13"
      ]
    }

  # Target namespace for clusters (comma-separated for multiple)
  targetNamespace: "default"

  # Teams configuration
  teams: '["acid"]'

# Ingress configuration
ingress:
  enabled: true
  ingressClassName: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    nginx.ingress.kubernetes.io/ssl-redirect: "true"

    # Optional: IP allowlisting
    # nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8"

  hosts:
  - host: postgres-ui.pnats.cloud
    paths:
    - /

  tls:
  - hosts:
    - postgres-ui.pnats.cloud
    secretName: postgres-ui-tls

# Resource limits
resources:
  limits:
    cpu: 200m
    memory: 200Mi
  requests:
    cpu: 100m
    memory: 100Mi

# RBAC and ServiceAccount
rbac:
  create: true

serviceAccount:
  create: true
  name: postgres-operator-ui

# Node selector, affinity, tolerations
nodeSelector: {}
tolerations: []
affinity: {}
