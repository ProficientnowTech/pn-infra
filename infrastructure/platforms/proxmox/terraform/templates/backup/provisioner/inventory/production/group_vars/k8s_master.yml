# inventory/production/group_vars/k8s_master.yml - K8s Master Configuration
---
# Role Configuration
role_id: 110
role_name: k8s-master

# Network Configuration
network_vlans:
  - name: management
    id: 107
    gateway: 192.168.107.1
  - name: internal_traffic
    id: 102
    gateway: 192.168.102.1
  - name: public_traffic
    id: 101
    gateway: 192.168.101.1

# Software Packages
base_packages:
  - name: curl
  - name: apt-transport-https
  - name: ca-certificates
  - name: gnupg
  - name: lsb-release
  - name: containerd
  - name: runc
  - name: nfs-common
  - name: open-iscsi
  - name: jq
  - name: socat
  - name: conntrack
  - name: ipset

# Base System Configuration
base_setup:
  timezone: Asia/Kolkata
  locale: en_US
  config_time_sync: true
  config_logging: true

# Security Configuration
security:
  setup_banner: true
  lock_root_account: false
  configure_password_policies: false
  configure_account_lockout_policy: false
  enable_ssh_hardening: false
  enable_kernel_hardening: false
  fail2ban:
    max_retries: 3
    bantime_secs: 3600
    findtime_secs: 600
    maxretry_attempts: 6
    destemail: snoorullah@proficientnowtech.com
  ssh:
    max_startups: 10
    login_grace_time_secs: 60
    permit_user_environment: true
    compression: false
    tcp_keep_alive: true
    allow_tcp_forwarding: true
    allow_stream_local_forwarding: true
    gateway_ports: false
    permit_tunnel: true
    disable_weak_algorithms: true
  kernel:
    secure_ipv4: true
    secure_ipv6: true
    disable_ipv6: false
    secure_memory: true
    restrict_insecure_processes: true
  filesystem:
    set_secure_permissions: true
    remove_world_readable_perms_from_sensitive_dirs: true
    set_sticky_bit_on_tmp_dirs: true
  audit:
    enable_logging: true
    monitor_auth: true
    monitor_login_logout_events: true
    monitor_network_config: true
    monitor_ssh_config: true
    monitor_sys_calls: true
    monitor_file_access: true
    lock_config: true
  # firewall_rules:
  #     - direction: in
  #       protocol: tcp
  #       port: 22
  #       source: management
  #       description: SSH management access
  #     - direction: in
  #       protocol: tcp
  #       port: 6443
  #       source: internal_traffic
  #       description: Kubernetes API server
  #     - direction: in
  #       protocol: tcp
  #       port: 2379
  #       source: internal_traffic
  #       description: etcd server client API
  #     - direction: in
  #       protocol: tcp
  #       port: 2380
  #       source: internal_traffic
  #       description: etcd server peer API
  #     - direction: in
  #       protocol: tcp
  #       port: 10250
  #       source: internal_traffic
  #       description: Kubelet API
  #     - direction: in
  #       protocol: tcp
  #       port: 10259
  #       source: internal_traffic
  #       description: kube-scheduler
  #     - direction: in
  #       protocol: tcp
  #       port: 10257
  #       source: internal_traffic
  #       description: kube-controller-manager

# System Maintenance
maintenance:
  enable_autoupdates: true

# Optimization
optimization:
  enable_network_optimization: true
  enable_fs_optimization: true

# Users Configuration
users:
  - username: ansible
    groups:
      - sudo
    sudo: true
    shell: /bin/bash
    lock_passwd: false
    hashed_passwd: $6$rounds=500000$7mvgcck9UMiYIh6I$UqhEkEgyqEKhUP/NeoE979MAR9/cx/qAHG5JdCifbeVy33yZG11j2ILjyRTIMAUnNg7z6yCdFCU7SfpqI1QqJ1
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPRWgKRmCzgC1JM2PPJkb8rhkyHyyeOoWEer0k+LQ+A2 proxmox-hyd (pn-production-k8s) created by ssh-manager
    ssh_client_config:
      strict_host_key_checking: true
      user_known_hosts_file: ~/.ssh/known_hosts
      pass_authentication: true
      pubkey_authentication: true
      identities_only: false
      log_level: INFO
      server_alive_interval: 60
      server_alive_count_max: 3
      connect_timeout: 10
  - username: ubuntu
    groups:
      - sudo
      - ansible
      - adm
    sudo: true
    shell: /bin/bash
    lock_passwd: false
    hashed_passwd: $6$rounds=500000$7mvgcck9UMiYIh6I$UqhEkEgyqEKhUP/NeoE979MAR9/cx/qAHG5JdCifbeVy33yZG11j2ILjyRTIMAUnNg7z6yCdFCU7SfpqI1QqJ1
    ssh_authorized_keys:
      - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPRWgKRmCzgC1JM2PPJkb8rhkyHyyeOoWEer0k+LQ+A2 proxmox-hyd (pn-production-k8s) created by ssh-manager
    ssh_client_config:
      strict_host_key_checking: true
      user_known_hosts_file: ~/.ssh/known_hosts
      pass_authentication: true
      pubkey_authentication: true
      identities_only: false
      log_level: INFO
      server_alive_interval: 60
      server_alive_count_max: 3
      connect_timeout: 10

# No additional directories for k8s-master (unlike ans-controller)
directories: []
