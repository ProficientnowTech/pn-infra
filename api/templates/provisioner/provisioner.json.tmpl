{
  "configPackage": "{{ .ConfigPackage }}",
  "environment": "{{ .Environment }}",
  "version": "v1.0.0",
  "roles": {
{{- $first := true }}
{{- range .Hosts }}
{{- if not $first }},{{ end }}{{ $first = false }}
    "{{ .Role }}": {
      "name": "{{ .Role }}",
      "description": "Role configuration for {{ .Role }}",
      "hosts": [
        {{- $hostFirst := true }}
        {{- range $host := $.Hosts }}
        {{- if eq $host.Role .Role }}
        {{- if not $hostFirst }},{{ end }}{{ $hostFirst = false }}
        "{{ $host.Name }}"
        {{- end }}
        {{- end }}
      ],
      "ansible": {
        "groups": {{ .Groups | toJson }},
        "vars": {
          "ansible_host": "{{ .Ip }}",
          "ansible_ssh_user": "{{ $.Ssh.User }}",
          "ansible_ssh_port": {{ $.Ssh.Port }},
          "ansible_ssh_private_key_file": "{{ $.Ssh.KeyPath }}"
        }
      },
      "resources": {
        "cpu": {{ .Cpu }},
        "memory": {{ .Memory }},
        "disk": {{ .Disk }}
      }
    }
{{- end }}
  },
  "ssh": {
    "user": "{{ .Ssh.User }}",
    "port": {{ .Ssh.Port }},
    "key_path": "{{ .Ssh.KeyPath }}"
  },
  "network": {
    "dns_servers": {{ .Networks.Management.DnsServers | toJson }},
    "gateway": "{{ .Networks.Management.Gateway }}",
    "domain": "{{ .Dns.Domain }}"
  },
  "ntp": {
    "servers": {{ .Ntp.Servers | toJson }}
  },
  "outputs": {
    "image_format": "qcow2",
    "base_path": "provisioner/outputs/{{ .Environment }}"
  }
}
