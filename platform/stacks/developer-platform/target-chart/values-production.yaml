# Production Environment
# Platform Developer Platform applications with sync wave ordering
applications:
# Tekton Operator must deploy first - provides CRDs for TektonConfig/TektonDashboard
# Uses Helm chart from kubebb repository (faster than GitHub clone)
- name: tekton-operator
  annotations:
    argocd.argoproj.io/sync-wave: "-5"
  destinationNamespaceOverwrite: tekton-operator
  repoURL: https://kubebb.github.io/components
  chart: tekton-operator
  targetRevision: 0.64.0
  helm:
    releaseName: tekton-operator
  # CRDs are mutated by the apiserver (status/managedFields/annotations), which
  # makes ArgoCD show them as OutOfSync even though the desired spec matches.
  ignoreDifferences:
  - group: apiextensions.k8s.io
    kind: CustomResourceDefinition
    jqPathExpressions:
    - .status
    - .metadata.annotations
    - .metadata.generation
    - .metadata.managedFields
    - .spec.preserveUnknownFields
  syncOptions:
  - CreateNamespace=true
  - ServerSideApply=true

- name: tekton-dashboard
  annotations:
    argocd.argoproj.io/sync-wave: "-4"
  destinationNamespaceOverwrite: tekton-pipelines
  syncOptions:
  - CreateNamespace=true
  - ServerSideApply=true

- name: backstage
  annotations:
    argocd.argoproj.io/sync-wave: '0'
  destinationNamespaceOverwrite: backstage
  syncOptions:
  - ServerSideApply=true
  - CreateNamespace=true

- name: harbor
  annotations:
    argocd.argoproj.io/sync-wave: "10"
  destinationNamespaceOverwrite: harbor
  syncOptions:
  - ServerSideApply=true
  - CreateNamespace=true

- name: verdaccio
  annotations:
    argocd.argoproj.io/sync-wave: "20"
  destinationNamespaceOverwrite: verdaccio
  syncOptions:
  - ServerSideApply=true
  - CreateNamespace=true

- name: clusterapi
  annotations:
    argocd.argoproj.io/sync-wave: "30"
  destinationNamespaceOverwrite: cluster-api
  syncOptions:
  - ServerSideApply=true
  - CreateNamespace=true

- name: kubevirt
  annotations:
    argocd.argoproj.io/sync-wave: '40'
  destinationNamespaceOverwrite: kubevirt
  syncOptions:
  - ServerSideApply=true
  - CreateNamespace=true

- name: kubevirt-cloud-controller-manager
  annotations:
    argocd.argoproj.io/sync-wave: '50'
  destinationNamespaceOverwrite: kubevirt
  syncOptions:
  - ServerSideApply=true

- name: kubevirt-manager
  annotations:
    argocd.argoproj.io/sync-wave: "60"
  destinationNamespaceOverwrite: kubevirt
  syncOptions:
  - ServerSideApply=true

commonLabels:
  platform.pnats.cloud/environment: 'production'
